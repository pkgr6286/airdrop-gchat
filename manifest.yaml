version: "2"

name: google-chat-airdrop-connector
description: Google Chat Connector for importing messages and threads into DevRev.

service_account:
  display_name: Google Chat Bot

functions:
  - name: extraction
    description: Extraction function for the Google Chat snap-in

developer_keyrings:
  - name: google-chat-oauth-secret
    description: DevRev developer keyring to store OAuth2 credentials for Google Chat.
    display_name: Google Chat OAuth Secret

keyrings:
  organization:
    - name: google_chat_connection
      display_name: Google Chat Connection
      description: The Google Chat connection for the organization.
      types:
        - google-chat-connection

keyring_types:
  - id: google-chat-connection
    name: "Google Chat Connection"
    description: "Connect to Google Chat using OAuth2"
    kind: "oauth2"
    scopes: # Scopes that the connection can request, add more scopes if needed for your use case. Each scope should have a name, description and value.
      - name: chat.messages.readonly
        description: Read access to chat messages
        value: "https://www.googleapis.com/auth/chat.messages.readonly"
      - name: chat.spaces.readonly
        description: Read access to chat spaces
        value: "https://www.googleapis.com/auth/chat.spaces.readonly"
    is_subdomain: false
    external_system_name: Google Chat
    oauth_secret: google-chat-oauth-secret
    scope_delimiter: " "
    authorize: # The authorize section is used to get the authorization code from the user and exchange it for an access token.
      type: "config"
      auth_url: "https://accounts.google.com/o/oauth2/v2/auth"
      token_url: "https://oauth2.googleapis.com/token"
      grant_type: "authorization_code"
      auth_query_parameters:
        "client_id": "[CLIENT_ID]"
        "scope": "[SCOPES]"
        "response_type": "code"
      token_query_parameters:
        "client_id": "[CLIENT_ID]"
        "client_secret": "[CLIENT_SECRET]"
    refresh: # The refresh section is used to refresh the access token using the refresh token.
      type: "config"
      url: "https://oauth2.googleapis.com/token"
      method: "POST"
      query_parameters:
        "client_id": "[CLIENT_ID]"
        "client_secret": "[CLIENT_SECRET]"
        "refresh_token": "[REFRESH_TOKEN]"
      headers:
        "Content-type": "application/x-www-form-urlencoded"
    revoke: # The revoke section is used to revoke the access token.
      type: "config"
      url: "https://oauth2.googleapis.com/revoke"
      method: "POST"
      headers:
        "Content-type": "application/x-www-form-urlencoded"
      query_parameters:
        "client_id": "[CLIENT_ID]"
        "client_secret": "[CLIENT_SECRET]"
        "token": "[ACCESS_TOKEN]"

imports:
  - slug: google-chat-import
    display_name: Google Chat Import
    description: Import threads and messages from Google Chat into DevRev
    extractor_function: extraction
    allowed_connection_types:
      - google-chat-connection