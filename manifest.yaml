version: "2"
name: google-chat-airdrop-connector
description: Google Chat Connector for importing messages and threads into DevRev.
version: '1.0'

functions:
  - name: extraction
    description: Extraction function for the Google Chat snap-in

imports:
  - slug: google-chat-import
    display_name: Google Chat Import
    description: Import threads and messages from Google Chat into DevRev
    extractor_function: extraction
    allowed_connection_types:
      - google-chat-connection

keyring_types:
  - id: google-chat-connection
    name: Google Chat Connection
    description: Connect to Google Chat using OAuth2
    kind: "oauth2"
    is_subdomain: false
    external_system_name: Google Chat
    oauth2_config:
      auth_url: 'https://accounts.google.com/o/oauth2/v2/auth'
      token_url: 'https://oauth2.googleapis.com/token'
      scope: 'https://www.googleapis.com/auth/chat.messages.readonly https://www.googleapis.com/auth/chat.spaces.readonly'
      # This URL is used to verify the token and get organization data (user's email in this case)
      organization_data:
        type: "config"
        url: 'https://www.googleapis.com/oauth2/v1/userinfo?alt=json'
        method: 'GET'
        response_jq: '{id: .email, name: .name}'